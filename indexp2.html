<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script src="//d3js.org/d3.v4.0.0-alpha.50.min.js"></script>
    <script src="//d3js.org/topojson.v1.min.js"></script>
    <script src="/datamaps.world.min.js"></script>
    <script src="defiantJS.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Gaegu|Stylish" rel="stylesheet">
    <!-- <script src="//d3js.org/d3.v4.min.js"></script> -->
    <script
  src="https://code.jquery.com/jquery-3.3.1.js"
  integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
  crossorigin="anonymous"></script>
</head>
<style>
/*
.square {
  width: 50px;
  height: 50px;
  background-color: blue;
  z-index: 1;
  position: absolute;
}

@keyframes pop_box {
    from {width: 0; height: 0;}
    to {width: 300px; height: 200px;}
}

@keyframes close_box {
    from {width: 300px; height: 200px;}
    to {width: 0; height: 0;}
}

#container {
  background-color: #1c2b44;
}

.datamaps_subunit:hover {
    background-color: #d7cec7;
}
.open_country_box {
  animation-name: pop_box;
  animation-duration: 1s;
  animation-fill-mode: forwards;
}
.close_country_box{
  animation-name: close_box;
  animation-duration: 1s;
  animation-fill-mode: forwards;
}

.country_box{
  background-color: #c5c8cc;
  border-radius: 20px;
  z-index: 1;
  position: absolute;
  opacity: 0.8;
}
*/

.graticule {
  fill: none;
  stroke: #777;
  stroke-width: 0.5px;
  stroke-opacity: 0.5;
}

.land {
  fill: #DCDCDC;
}

.boundary {
  fill: none;
  stroke: #fff;
  stroke-width: 0.5px;
}

.SVGmiddle {
  margin-top: 25px;
  margin-left: 20%
}

.introText {
  font-size: 32pt;
  margin-left: 28%;
  margin-top: 20px;
  font-family: Arial;
}

.introText2 {
  font-size: 20pt;
  margin-left: 34%;
  margin-top: 5px;
}

.introText3 {
  font-size: 16pt;
  margin-left: 38%;
  margin-top: 5px;
}

.introText4 {
  font-size: 4pt;
  margin-left: 41%;
  margin-top: 5px;
}


</style>
<body>
  <!--<<div id="container" style="position: absolute; width: 1500px; height: 800px; z-index: -1;"></div>-->
  <p class="introText">Top Video Game Genres Around The World*</p>
  <p class="introText2">Do America's love of guns translate to virtual reality?</p>
  <p class="introText3">Is France as infatuated with Strategy as Napoleon?</p>
  <p class="introText3">Are Canadians as nice online as they are offline?</p>

  <script>
/*
    var usedCountries_color = "#7599d8"
     var map = new Datamap({element: document.getElementById('container'),
      fills: {
        // defaultFill: "#ABDDA4",
        defaultFill: "#616977",
        // usedCountries: "#fa0fa0"
        usedCountries: usedCountries_color
      },
      data: {
          USA: { fillKey: "usedCountries" },
          AUS: { fillKey: "usedCountries" },
          BRA: { fillKey: "usedCountries" },
          CAN: { fillKey: "usedCountries" },
          GBR: { fillKey: "usedCountries" },
          CHN: { fillKey: "usedCountries" },
          FRA: { fillKey: "usedCountries" },
          DEU: { fillKey: "usedCountries" },
          POL: { fillKey: "usedCountries" },
          RUS: { fillKey: "usedCountries" },
      },
      geographyConfig: {
        highlightFillColor: "#8fd8d2",
        //this is the customization template
        // borderWidth: 1,
        // borderOpacity: 1,
        // borderColor: '#fff',
        // popupOnHover: true,
        // highlightOnHover: true,
        // highlightFillColor: function(data) {
        //   if (data.fillKey) {
        //     return 'green';
        //   }
        //   return '#dbdbdb';
        // },
        // highlightBorderColor: '#fff',
        // popupTemplate: function(geo, data) {
        //   // don't show tooltip if country don't present in dataset
        //   if (!data) {
        //     return;
        //   }
        //   // tooltip content
        //   return ['',
        //           '<div class ="hoverinfo">' + geo.properties.name, ''
        //          ].join('');
        // }
      },

      done: function(datamap) {
            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

              if(geography.properties.name == "United States of America"){
                geography.properties.name = "USA";
              }
              if(geography.properties.name == "United Kingdom"){
                geography.properties.name = "GBR";
              }
              var name = geography.properties.name;
              var natDataBox = name.replace(" ","-") + "-dataBox";



              if($(natDataBox).length > 0){
                console.log("xd");
                document.getElementById(natDataBox).className = document.getElementById(natDataBox).className.replace( 'open_country_box' , '' );
                document.getElementById(natDataBox).className += " close_country_box";

                setTimeout( function(){
                        $(natDataBox).remove();
                },1001);
                console.log($(natDataBox));

                return;
              }
              var centroid = map.path.centroid(geography);
              console.log(geography.properties.name);
              console.log(centroid);

              var dataBox = document.createElement(natDataBox);
              var newX = centroid[0];
              dataBox.innerHTML = '<div id="'+natDataBox+'" class="country_box open_country_box" style="margin-left:' + newX + 'px' + ';' + ' margin-top:' + centroid[1] + 'px' + ';' + '"' + '>';
              document.body.appendChild(dataBox);

            });

          }
        });
        */

var width = 1000,
    height = 500;

var projection = d3.geoEquirectangular()
    .scale(height / Math.PI)
    .translate([width / 2, height / 2]);

var path = d3.geoPath()
    .projection(projection);

var graticule = d3.geoGraticule();


/*d3.json("world.json",function(error, world){
if(error) throw error;
countries = topojson.feature(world, world.objects.countries).features
});*/

//get country data, iso_a, name, etc.
var countryData;
$.getJSON("countryData.json", function(data){
  countryData = data;
  // console.log(countryData);
});

//get gameInfo per country on iso_a
var countryGameData;
$.getJSON("country_top3_tags.json", function(data){
  countryGameData = data;
  // console.log(countryGameData);
});

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("class", "SVGmiddle");
/*
svg.append("path")
    .datum(graticule)
    .attr("class", "graticule") //, "graticule"
    .attr("d", path);
*/
var countries;

d3.json("https://unpkg.com/world-atlas@1/world/50m.json", function(error, world) {
  if (error) throw error;
  var countries = topojson.feature(world, world.objects.countries).features;

  svg.selectAll(".land")
      .data(countries)
    .enter().insert("path", ".boundary")
      .attr("class", "land")
      .attr("d", path)
      .style("fill", function(d){
        var searchStringColor = '//countries[iso=' + d.id + ']/color';
        console.log(searchStringColor);
        var color_arr = JSON.search(countryData, searchStringColor);
        if (color_arr.length!=0) {
          var color = color_arr[0];
        }else{
          var color = "#DCDCDC";
        }
        console.log(color)
        return color;
      })
      .on("click", function(d){

        searchString = '//countries[iso=' + d.id + ']/country';
        // console.log(searchString);
        var country_clicked = JSON.search(countryData, searchString)[0];
        console.log(country_clicked);

        searchString = '//countries[iso=' + d.id + ']/genres';
        // console.log(searchString);
        var genre_arr = JSON.search(countryData, searchString);
        console.log(genre_arr);

      })
      .on("mouseover", function (d){
        searchString = '//countries[iso=' + d.id + ']/iso_a';
        // console.log(searchString);
        var d_iso_a = JSON.search(countryData, searchString);
        //if this is indeed interested 10 countries
        if (d_iso_a.length!=0) {
          d3.select(this).style("opacity", "0.5");
          //add pop up info
          searchString = '//countries[iso=' + d.id + ']/iso';
          var d_iso = JSON.search(countryData, searchString);
          d3.select("#info_box_"+d_iso)
          .style("display","block");
          d3.select("#info_line1_"+d_iso)
          .style("display","block");

          d3.select("#info_line3_"+d_iso)
          .style("display","block");
          d3.select("#info_line4_"+d_iso)
          .style("display","block");
          d3.select("#info_line5_"+d_iso)
          .style("display","block");


        }
      })
      .on("mousemove",function (d) {
        searchString = '//countries[iso=' + d.id + ']/iso_a';
        // console.log(searchString);
        var d_iso_a = JSON.search(countryData, searchString);
        //if this is indeed interested 10 countries
        if (d_iso_a.length!=0) {
          searchString = '//countries[iso=' + d.id + ']/iso';
          // console.log(searchString);
          var d_iso = JSON.search(countryData, searchString);
          var mouse = [0, 0];
          mouse = d3.mouse(this);
          var mouse_x = mouse[0];
          var mouse_y = mouse[1];

          d3.select("#info_box_"+d_iso)
          .attr("x",mouse_x+15)
          .attr("y",mouse_y+15)

          d3.select("#info_line1_"+d_iso)
          .attr("x",mouse_x+30)
          .attr("y",mouse_y+40);

          d3.select("#info_line2")
          .remove();

          svg.append("text")
          .style("font-size","1em")
          .style("font-family","'Gaegu', cursive")
          .attr("id","info_line2")
          .text("Top Genres:")
          .attr("x",mouse_x+30)
          .attr("y",mouse_y+55);

          d3.select("#info_line3_"+d_iso)
          .attr("x",mouse_x+30)
          .attr("y",mouse_y+70);

          d3.select("#info_line4_"+d_iso)
          .attr("x",mouse_x+30)
          .attr("y",mouse_y+85);

          d3.select("#info_line5_"+d_iso)
          .attr("x",mouse_x+30)
          .attr("y",mouse_y+100);

          // d3.select("#info_line2")
          // .attr("x",mouse_x+35)
          // .attr("y",mouse_y+45);

        }
      })
      .on("mouseout", function(d) {
        d3.select(this).style("opacity", "1")
        d3.select(this).style("fill", function () {
          var searchStringColor = '//countries[iso=' + d.id + ']/color';
          console.log(searchStringColor);
          var color_arr = JSON.search(countryData, searchStringColor);
          if (color_arr.length!=0) {
            var color = color_arr[0];
          }else{
            var color = "#DCDCDC";
          }
          console.log(color)
          return color;
        });
        searchString = '//countries[iso=' + d.id + ']/iso';
        var d_iso = JSON.search(countryData, searchString);

        d3.select("#info_box_"+d_iso)
        .style("display","none");
        d3.select("#info_line1_"+d_iso)
        .style("display","none");
        d3.select("#info_line2")
        .remove();
        d3.select("#info_line3_"+d_iso)
        .style("display","none");
        d3.select("#info_line4_"+d_iso)
        .style("display","none");
        d3.select("#info_line5_"+d_iso)
        .style("display","none");
        // .style("display","none");
      });

  //add info box
  var info_box_width = "150";
  var info_box_height = "120";
  var info_boxes = svg.selectAll(".info_boxes")
  .data(countries);

  info_boxes = info_boxes.enter().insert("rect")
  .filter(function (d) {
    searchString = '//countries[iso=' + d.id + ']/iso_a';
        searchString = '//countries[iso=' + d.id + ']/iso_a';
        var d_iso_a = JSON.search(countryData, searchString);
        //if this is indeed interested 10 countries
        return d_iso_a.length!=0
  })
  .attr("width",info_box_width)
  .attr("height",info_box_height)
  .merge(info_boxes);

  info_boxes
  .attr("class","info_boxes")
  .attr("id",function (d) {
    searchString = '//countries[iso=' + d.id + ']/iso';
    var d_iso = JSON.search(countryData, searchString);
    return "info_box_"+d_iso;
  })
  .style("display","none")
  .style("fill","#b5c7e5")
  .attr("rx","15")
  .attr("ry","15")

  //add line1
  var info_line1s = svg.selectAll(".info_line1s")
  .data(countries);

  info_line1s = info_line1s.enter().insert("text")
  .filter(function (d) {
    searchString = '//countries[iso=' + d.id + ']/iso_a';
        searchString = '//countries[iso=' + d.id + ']/iso_a';
        var d_iso_a = JSON.search(countryData, searchString);
        //if this is indeed interested 10 countries
        return d_iso_a.length!=0
  })
  .style("font-size","1em")
  .style("font-family","'Gaegu', cursive")
  .style("display","none")
  .merge(info_line1s);

  info_line1s
  .attr("class","info_line1s")
  .attr("id",function (d) {
    searchString = '//countries[iso=' + d.id + ']/iso';
    var d_iso = JSON.search(countryData, searchString);
    return "info_line1_"+d_iso;
  })
  .text(function (d) {
    searchString = '//countries[iso=' + d.id + ']/country';
    var d_country = JSON.search(countryData, searchString);
    return "Country: "+d_country
  });

  for (var i = 3; i < 6; i++) {
    //add line3,4,5
    var info_lineis = svg.selectAll(".info_line"+i+"s")
    .data(countries);

    info_lineis = info_lineis.enter().insert("text")
    .filter(function (d) {
      searchString = '//countries[iso=' + d.id + ']/iso_a';
          searchString = '//countries[iso=' + d.id + ']/iso_a';
          var d_iso_a = JSON.search(countryData, searchString);
          //if this is indeed interested 10 countries
          return d_iso_a.length!=0
    })
    .style("font-size","1em")
    .style("font-family","'Gaegu', cursive")
    .style("display","none")
    .merge(info_lineis);

    info_lineis
    .attr("class","info_line"+i+"s")
    .attr("id",function (d) {
      searchString = '//countries[iso=' + d.id + ']/iso';
      var d_iso = JSON.search(countryData, searchString);
      return "info_line"+i+"_"+d_iso;
    })
    .text(function (d) {
      searchString = '//countries[iso=' + d.id + ']/genres';
      var d_genre_i = JSON.search(countryData, searchString)[i-3];
      return i-2+". "+d_genre_i
    });
  }

  // .html(function (d) {
  //   searchString = '//countries[iso=' + d.id + ']/country';
  //   var d_country = JSON.search(countryData, searchString);
  //   searchString = '//countries[iso=' + d.id + ']/genres';
  //   var d_genre = JSON.search(countryData, searchString);
  //   var line1 = "Country: "+d_country+"<br>";
  //   var line2 = "Top 3 Genres: <br>";
  //   var line3 = d_genre[0]+"<br>";
  //   var line3 = d_genre[1]+"<br>";
  //   var line3 = d_genre[2]+"<br>";
  // })

  /*countries = topojson.feature(world, world.objects.countries).features

  svg.insert("path", "graticule") //, "graticule"
      .datum(topojson.feature(world, world.objects.land))
      .attr("class", "land")
      .attr("d", path);

  svg.insert("path", "graticule") //, "graticule"
      .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }))
      .attr("class", "boundary")
      .attr("d", path);

      d3.select("svg").selectAll("path")
      .data(countries)
      .enter().append("path")
      .attr("d", path)
      .on("click", function(d){

        searchString = '//countries[iso=' + d.id + ']/country';
        console.log(searchString);
        res = JSON.search(countryData, searchString);
        console.log(res);

        searchString = '//countries[iso=' + d.id + ']/genres';
        console.log(searchString);
        res = JSON.search(countryData, searchString);
        console.log(res);

      });*/



});

/*
        searchString2 = '//countries[country=' + isoVar + ']/genres';
        console.log(searchString);
        res2 = JSON.search(countryGameData, searchString2);
        console.log(res2);

      })
      .on("mouseover",function(d){
        var currentState = this;
        d3.select(this).style('fill', "red");
        console.log(d.id);
        searchString = '//countries[iso=' + d.id + ']/iso_a';
        res = JSON.search(countryData, searchString);
        console.log(res);
      });


});
*/


  </script>
</body>
</html>
